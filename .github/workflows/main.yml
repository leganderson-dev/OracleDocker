name: SQL Server with Init Script

on:
  push:
    branches:
    - main
  workflow_dispatch:


jobs:
  run-sqlserver:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Build SQL Server image
      run: docker build -t sqlserver-init .

    - name: Run SQL Server container
      run: docker run -d --name sql-init -p 1433:1433 sqlserver-init

    - name: Confirm DB created
      run: |
        sleep 30
        docker exec sql-init /opt/mssql-tools/bin/sqlcmd \
          -S localhost -U SA -P 'Redg@te1' -Q "SELECT name FROM sys.databases"
