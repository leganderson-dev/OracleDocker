name: MSSQL Restore Demo

on:
  workflow_dispatch:


jobs:
  restore-db:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Build SQL Server Docker image with backup
      run: |
        docker build -t mssql-ssc-dev -f Dockerfile .

    - name: Run SQL Server container
      run: |
        docker run -d --name mssql-container \
          -e 'ACCEPT_EULA=Y' \
          -e 'SA_PASSWORD=Redg@te1' \
          -p 1433:1433 \
          mssql-ssc-dev

    - name: Wait for SQL Server and run restore script
      run: |
        docker exec mssql-container /bin/bash /tmp/restore.sh

    - name: Show restored database list (confirmation)
      run: |
        docker exec mssql-container /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P 'Redg@te1' -Q "SELECT name FROM sys.databases"
